<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #121212;
            color: #e0e0e0;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #1f1f1f;
            color: #e0e0e0;
        }

        .back-button {
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #ff4081;
            color: #e0e0e0;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .back-button:hover {
            background-color: #ff5a92;
            transform: scale(1.05);
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: #1e1e1e;
        }

        .location-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 80%;
            max-width: 600px;
        }

        .location-button, .confirm-button {
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            color: #e0e0e0;
            transition: box-shadow 0.3s, transform 0.3s;
            background-color: #2a2a2a;
            border: none;
        }

        .location-button:hover, .confirm-button:hover {
            transform: scale(1.05);
        }

        .location-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .location-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .location-checkbox input {
            margin: 0;
        }

        .location-checkbox:hover {
            background-color: #ff4081;
        }

        .confirm-button {
            margin-top: 20px;
        }

        .selected-locations {
            margin-top: 20px;
            color: #ff4081;
            font-size: 1.2rem;
        }

        .available-locations {
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
            color: #ff4081;
        }

        .available-locations span {
            font-size: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <button class="back-button" onclick="window.location.href='home.html'">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        <div class="logo">Location Settings</div>
    </header>

    <main>
        <div class="available-locations" id="available-locations">
            <!-- Display available locations here -->
        </div>

        <div class="location-options">
            <button class="location-button" id="track-location">
                <i class="fas fa-map-marker-alt"></i> Track My Location
            </button>
        </div>

        <div class="location-checkboxes">
            <!-- Dynamically generated location checkboxes will be inserted here -->
        </div>

        <div class="selected-locations" id="selected-locations">
            <!-- Display selected locations here -->
        </div>

        <button class="confirm-button" id="confirm-button">
            Confirm
        </button>
    </main>

    <script type="module">
        // Import Firebase scripts
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
        import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAm9VTkFRrLYC2jnT3xAy8kwj2cAjLjyI4",
            authDomain: "projj-7fa1d.firebaseapp.com",
            projectId: "projj-7fa1d",
            storageBucket: "projj-7fa1d.appspot.com",
            messagingSenderId: "731552517830",
            appId: "1:731552517830:web:10447552198f5af07c91c7",
            measurementId: "G-H5JBP27FBD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const countries = {
            "Afghanistan": "ğŸ‡¦ğŸ‡«", "Albania": "ğŸ‡¦ğŸ‡±", "Algeria": "ğŸ‡©ğŸ‡¿", "Andorra": "ğŸ‡¦ğŸ‡©", "Angola": "ğŸ‡¦ğŸ‡´",
            "Antigua and Barbuda": "ğŸ‡¦ğŸ‡¬", "Argentina": "ğŸ‡¦ğŸ‡·", "Armenia": "ğŸ‡¦ğŸ‡²", "Australia": "ğŸ‡¦ğŸ‡º", "Austria": "ğŸ‡¦ğŸ‡¹",
            "Azerbaijan": "ğŸ‡¦ğŸ‡¿", "Bahamas": "ğŸ‡§ğŸ‡¸", "Bahrain": "ğŸ‡§ğŸ‡­", "Bangladesh": "ğŸ‡§ğŸ‡©", "Barbados": "ğŸ‡§ğŸ‡§",
            "Belarus": "ğŸ‡§ğŸ‡¾", "Belgium": "ğŸ‡§ğŸ‡ª", "Belize": "ğŸ‡§ğŸ‡¿", "Benin": "ğŸ‡§ğŸ‡¯", "Bhutan": "ğŸ‡§ğŸ‡¹",
            "Bolivia": "ğŸ‡§ğŸ‡´", "Bosnia and Herzegovina": "ğŸ‡§ğŸ‡¦", "Botswana": "ğŸ‡§ğŸ‡¼", "Brazil": "ğŸ‡§ğŸ‡·", "Brunei": "ğŸ‡§ğŸ‡³",
            "Bulgaria": "ğŸ‡§ğŸ‡¬", "Burkina Faso": "ğŸ‡§ğŸ‡«", "Burundi": "ğŸ‡§ğŸ‡®", "Cabo Verde": "ğŸ‡¨ğŸ‡»", "Cambodia": "ğŸ‡°ğŸ‡­",
            "Cameroon": "ğŸ‡¨ğŸ‡²", "Canada": "ğŸ‡¨ğŸ‡¦", "Central African Republic": "ğŸ‡¨ğŸ‡«", "Chad": "ğŸ‡¹ğŸ‡©", "Chile": "ğŸ‡¨ğŸ‡±",
            "China": "ğŸ‡¨ğŸ‡³", "Colombia": "ğŸ‡¨ğŸ‡´", "Comoros": "ğŸ‡°ğŸ‡²", "Congo": "ğŸ‡¨ğŸ‡¬", "Costa Rica": "ğŸ‡¨ğŸ‡·",
            "Croatia": "ğŸ‡­ğŸ‡·", "Cuba": "ğŸ‡¨ğŸ‡º", "Cyprus": "ğŸ‡¨ğŸ‡¾", "Czech Republic": "ğŸ‡¨ğŸ‡¿", "Denmark": "ğŸ‡©ğŸ‡°",
            "Djibouti": "ğŸ‡©ğŸ‡¯", "Dominica": "ğŸ‡©ğŸ‡²", "Dominican Republic": "ğŸ‡©ğŸ‡´", "Ecuador": "ğŸ‡ªğŸ‡¨", "Egypt": "ğŸ‡ªğŸ‡¬",
            "El Salvador": "ğŸ‡¸ğŸ‡»", "Equatorial Guinea": "ğŸ‡¬ğŸ‡¶", "Eritrea": "ğŸ‡ªğŸ‡·", "Estonia": "ğŸ‡ªğŸ‡ª", "Eswatini": "ğŸ‡¸ğŸ‡¿",
            "Ethiopia": "ğŸ‡ªğŸ‡¹", "Fiji": "ğŸ‡«ğŸ‡¯", "Finland": "ğŸ‡«ğŸ‡®", "France": "ğŸ‡«ğŸ‡·", "Gabon": "ğŸ‡¬ğŸ‡¦",
            "Gambia": "ğŸ‡¬ğŸ‡²", "Georgia": "ğŸ‡¬ğŸ‡ª", "Germany": "ğŸ‡©ğŸ‡ª", "Ghana": "ğŸ‡¬ğŸ‡­", "Greece": "ğŸ‡¬ğŸ‡·",
            "Grenada": "ğŸ‡¬ğŸ‡©", "Guatemala": "ğŸ‡¬ğŸ‡¹", "Guinea": "ğŸ‡¬ğŸ‡³", "Guinea-Bissau": "ğŸ‡¬ğŸ‡¼", "Guyana": "ğŸ‡¬ğŸ‡¾",
            "Haiti": "ğŸ‡­ğŸ‡¹", "Honduras": "ğŸ‡­ğŸ‡³", "Hungary": "ğŸ‡­ğŸ‡º", "Iceland": "ğŸ‡®ğŸ‡¸", "India": "ğŸ‡®ğŸ‡³",
            "Indonesia": "ğŸ‡®ğŸ‡©", "Iran": "ğŸ‡®ğŸ‡·", "Iraq": "ğŸ‡®ğŸ‡¶", "Ireland": "ğŸ‡®ğŸ‡ª", "Israel": "ğŸ‡®ğŸ‡±",
            "Italy": "ğŸ‡®ğŸ‡¹", "Jamaica": "ğŸ‡¯ğŸ‡²", "Japan": "ğŸ‡¯ğŸ‡µ", "Jordan": "ğŸ‡¯ğŸ‡´", "Kazakhstan": "ğŸ‡°ğŸ‡¿",
            "Kenya": "ğŸ‡°ğŸ‡ª", "Kiribati": "ğŸ‡°ğŸ‡®", "Kuwait": "ğŸ‡°ğŸ‡¼", "Kyrgyzstan": "ğŸ‡°ğŸ‡¬", "Laos": "ğŸ‡±ğŸ‡¦",
            "Latvia": "ğŸ‡±ğŸ‡»", "Lebanon": "ğŸ‡±ğŸ‡§", "Lesotho": "ğŸ‡±ğŸ‡¸", "Liberia": "ğŸ‡±ğŸ‡·", "Libya": "ğŸ‡±ğŸ‡¾",
            "Liechtenstein": "ğŸ‡±ğŸ‡®", "Lithuania": "ğŸ‡±ğŸ‡¹", "Luxembourg": "ğŸ‡±ğŸ‡º", "Madagascar": "ğŸ‡²ğŸ‡¬", "Malawi": "ğŸ‡²ğŸ‡¼",
            "Malaysia": "ğŸ‡²ğŸ‡¾", "Maldives": "ğŸ‡²ğŸ‡»", "Mali": "ğŸ‡²ğŸ‡±", "Malta": "ğŸ‡²ğŸ‡¹", "Marshall Islands": "ğŸ‡²ğŸ‡­",
            "Mauritania": "ğŸ‡²ğŸ‡·", "Mauritius": "ğŸ‡²ğŸ‡º", "Mexico": "ğŸ‡²ğŸ‡½", "Micronesia": "ğŸ‡«ğŸ‡²", "Moldova": "ğŸ‡²ğŸ‡©",
            "Monaco": "ğŸ‡²ğŸ‡¨", "Mongolia": "ğŸ‡²ğŸ‡³", "Montenegro": "ğŸ‡²ğŸ‡ª", "Morocco": "ğŸ‡²ğŸ‡¦", "Mozambique": "ğŸ‡²ğŸ‡¿",
            "Myanmar": "ğŸ‡²ğŸ‡²", "Namibia": "ğŸ‡³ğŸ‡¦", "Nauru": "ğŸ‡³ğŸ‡·", "Nepal": "ğŸ‡³ğŸ‡µ", "Netherlands": "ğŸ‡³ğŸ‡±",
            "New Zealand": "ğŸ‡³ğŸ‡¿", "Nicaragua": "ğŸ‡³ğŸ‡®", "Niger": "ğŸ‡³ğŸ‡ª", "Nigeria": "ğŸ‡³ğŸ‡¬", "North Korea": "ğŸ‡°ğŸ‡µ",
            "North Macedonia": "ğŸ‡²ğŸ‡°", "Norway": "ğŸ‡³ğŸ‡´", "Oman": "ğŸ‡´ğŸ‡²", "Pakistan": "ğŸ‡µğŸ‡°", "Palau": "ğŸ‡µğŸ‡¼",
            "Palestine": "ğŸ‡µğŸ‡¸", "Panama": "ğŸ‡µğŸ‡¦", "Papua New Guinea": "ğŸ‡µğŸ‡¬", "Paraguay": "ğŸ‡µğŸ‡¾", "Peru": "ğŸ‡µğŸ‡ª",
            "Philippines": "ğŸ‡µğŸ‡­", "Poland": "ğŸ‡µğŸ‡±", "Portugal": "ğŸ‡µğŸ‡¹", "Qatar": "ğŸ‡¶ğŸ‡¦", "Romania": "ğŸ‡·ğŸ‡´",
            "Russia": "ğŸ‡·ğŸ‡º", "Rwanda": "ğŸ‡·ğŸ‡¼", "Saint Kitts and Nevis": "ğŸ‡°ğŸ‡³", "Saint Lucia": "ğŸ‡±ğŸ‡¨", "Saint Vincent and the Grenadines": "ğŸ‡»ğŸ‡¨",
            "Samoa": "ğŸ‡¼ğŸ‡¸", "San Marino": "ğŸ‡¸ğŸ‡²", "Sao Tome and Principe": "ğŸ‡¸ğŸ‡¹", "Saudi Arabia": "ğŸ‡¸ğŸ‡¦", "Senegal": "ğŸ‡¸ğŸ‡³",
            "Serbia": "ğŸ‡·ğŸ‡¸", "Seychelles": "ğŸ‡¸ğŸ‡¨", "Sierra Leone": "ğŸ‡¸ğŸ‡±", "Singapore": "ğŸ‡¸ğŸ‡¬", "Slovakia": "ğŸ‡¸ğŸ‡°",
            "Slovenia": "ğŸ‡¸ğŸ‡®", "Solomon Islands": "ğŸ‡¸ğŸ‡§", "Somalia": "ğŸ‡¸ğŸ‡´", "South Africa": "ğŸ‡¿ğŸ‡¦", "South Korea": "ğŸ‡°ğŸ‡·",
            "South Sudan": "ğŸ‡¸ğŸ‡¸", "Spain": "ğŸ‡ªğŸ‡¸", "Sri Lanka": "ğŸ‡±ğŸ‡°", "Sudan": "ğŸ‡¸ğŸ‡©", "Suriname": "ğŸ‡¸ğŸ‡·",
            "Sweden": "ğŸ‡¸ğŸ‡ª", "Switzerland": "ğŸ‡¨ğŸ‡­", "Syria": "ğŸ‡¸ğŸ‡¾", "Taiwan": "ğŸ‡¹ğŸ‡¼", "Tajikistan": "ğŸ‡¹ğŸ‡¯",
            "Tanzania": "ğŸ‡¹ğŸ‡¿", "Thailand": "ğŸ‡¹ğŸ‡­", "Togo": "ğŸ‡¹ğŸ‡¬", "Tonga": "ğŸ‡¹ğŸ‡´", "Trinidad and Tobago": "ğŸ‡¹ğŸ‡¹",
            "Tunisia": "ğŸ‡¹ğŸ‡³", "Turkey": "ğŸ‡¹ğŸ‡·", "Turkmenistan": "ğŸ‡¹ğŸ‡²", "Tuvalu": "ğŸ‡¹ğŸ‡»", "Uganda": "ğŸ‡ºğŸ‡¬",
            "Ukraine": "ğŸ‡ºğŸ‡¦", "United Arab Emirates": "ğŸ‡¦ğŸ‡ª", "United Kingdom": "ğŸ‡¬ğŸ‡§", "United States": "ğŸ‡ºğŸ‡¸", "Uruguay": "ğŸ‡ºğŸ‡¾",
            "Uzbekistan": "ğŸ‡ºğŸ‡¿", "Vanuatu": "ğŸ‡»ğŸ‡º", "Vatican City": "ğŸ‡»ğŸ‡¦", "Venezuela": "ğŸ‡»ğŸ‡ª", "Vietnam": "ğŸ‡»ğŸ‡³",
            "Yemen": "ğŸ‡¾ğŸ‡ª", "Zambia": "ğŸ‡¿ğŸ‡²", "Zimbabwe": "ğŸ‡¿ğŸ‡¼"
        };

        const selectedLocations = [];

        const updateSelectedLocationsUI = () => {
            const selectedLocationsElement = document.getElementById('selected-locations');
            selectedLocationsElement.innerHTML = selectedLocations.map(country => `${countries[country]} ${country}`).join(', ');
        };

        const updateAvailableLocationsUI = (locations) => {
            const availableLocationsElement = document.getElementById('available-locations');
            availableLocationsElement.innerHTML = `You are available in: ${locations.map(country => `${countries[country]} ${country}`).join(', ')}`;
        };

        // Function to load user locations
        const loadUserLocations = async () => {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userDocRef = doc(db, "users", user.uid);
                    const userDoc = await getDoc(userDocRef);
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const userLocations = userData.location || [];
                        updateAvailableLocationsUI(userLocations);
                    }
                }
            });
        };

        // Load the locations when the page is loaded
        loadUserLocations();

        // Function to dynamically generate location checkboxes
        const generateLocationCheckboxes = () => {
            const locationCheckboxesElement = document.querySelector('.location-checkboxes');
            locationCheckboxesElement.innerHTML = '';
            Object.keys(countries).forEach(country => {
                const label = document.createElement('label');
                label.classList.add('location-checkbox');
                label.innerHTML = `
                    <input type="checkbox" value="${country}"> ${countries[country]} ${country}
                `;
                label.addEventListener('click', (e) => {
                    const checkbox = label.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    if (checkbox.checked && !selectedLocations.includes(country)) {
                        selectedLocations.push(country);
                    } else if (!checkbox.checked && selectedLocations.includes(country)) {
                        const index = selectedLocations.indexOf(country);
                        if (index > -1) {
                            selectedLocations.splice(index, 1);
                        }
                    }
                    updateSelectedLocationsUI();
                });
                locationCheckboxesElement.appendChild(label);
            });
        };

        // Generate checkboxes on page load
        generateLocationCheckboxes();

        // Function to handle track location button click
        document.getElementById('track-location').addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const { latitude, longitude } = position.coords;
                    const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
                    const data = await response.json();
                    const country = data.countryName;
                    if (country && !selectedLocations.includes(country) && countries[country]) {
                        selectedLocations.push(country);
                        updateSelectedLocationsUI();
                    } else if (!countries[country]) {
                        alert('Unable to determine your location.');
                    }
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });

        // Function to handle confirm button click
        document.getElementById('confirm-button').addEventListener('click', async () => {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userDocRef = doc(db, "users", user.uid);
                    await updateDoc(userDocRef, {
                        location: selectedLocations
                    });
                    alert('Locations saved successfully!');
                    loadUserLocations(); // Refresh the UI
                }
            });
        });
    </script>
</body>
</html>
