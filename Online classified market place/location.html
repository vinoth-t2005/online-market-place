<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #121212;
            color: #e0e0e0;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #1f1f1f;
            color: #e0e0e0;
        }

        .back-button {
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #ff4081;
            color: #e0e0e0;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .back-button:hover {
            background-color: #ff5a92;
            transform: scale(1.05);
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: #1e1e1e;
        }

        .location-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 80%;
            max-width: 600px;
        }

        .location-button, .confirm-button {
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            color: #e0e0e0;
            transition: box-shadow 0.3s, transform 0.3s;
            background-color: #2a2a2a;
            border: none;
        }

        .location-button:hover, .confirm-button:hover {
            transform: scale(1.05);
        }

        .location-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .location-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .location-checkbox input {
            margin: 0;
        }

        .location-checkbox:hover {
            background-color: #ff4081;
        }

        .confirm-button {
            margin-top: 20px;
        }

        .selected-locations {
            margin-top: 20px;
            color: #ff4081;
            font-size: 1.2rem;
        }

        .available-locations {
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
            color: #ff4081;
        }

        .available-locations span {
            font-size: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <button class="back-button" onclick="window.location.href='home.html'">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        <div class="logo">Location Settings</div>
    </header>

    <main>
        <div class="available-locations" id="available-locations">
            <!-- Display available locations here -->
        </div>

        <div class="location-options">
            <button class="location-button" id="track-location">
                <i class="fas fa-map-marker-alt"></i> Track My Location
            </button>
        </div>

        <div class="location-checkboxes">
            <!-- Dynamically generated location checkboxes will be inserted here -->
        </div>

        <div class="selected-locations" id="selected-locations">
            <!-- Display selected locations here -->
        </div>

        <button class="confirm-button" id="confirm-button">
            Confirm
        </button>
    </main>

    <script type="module">
        // Import Firebase scripts
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
        import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAm9VTkFRrLYC2jnT3xAy8kwj2cAjLjyI4",
            authDomain: "projj-7fa1d.firebaseapp.com",
            projectId: "projj-7fa1d",
            storageBucket: "projj-7fa1d.appspot.com",
            messagingSenderId: "731552517830",
            appId: "1:731552517830:web:10447552198f5af07c91c7",
            measurementId: "G-H5JBP27FBD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const countries = {
            "Afghanistan": "ðŸ‡¦ðŸ‡«", "Albania": "ðŸ‡¦ðŸ‡±", "Algeria": "ðŸ‡©ðŸ‡¿", "Andorra": "ðŸ‡¦ðŸ‡©", "Angola": "ðŸ‡¦ðŸ‡´",
            "Antigua and Barbuda": "ðŸ‡¦ðŸ‡¬", "Argentina": "ðŸ‡¦ðŸ‡·", "Armenia": "ðŸ‡¦ðŸ‡²", "Australia": "ðŸ‡¦ðŸ‡º", "Austria": "ðŸ‡¦ðŸ‡¹",
            "Azerbaijan": "ðŸ‡¦ðŸ‡¿", "Bahamas": "ðŸ‡§ðŸ‡¸", "Bahrain": "ðŸ‡§ðŸ‡­", "Bangladesh": "ðŸ‡§ðŸ‡©", "Barbados": "ðŸ‡§ðŸ‡§",
            "Belarus": "ðŸ‡§ðŸ‡¾", "Belgium": "ðŸ‡§ðŸ‡ª", "Belize": "ðŸ‡§ðŸ‡¿", "Benin": "ðŸ‡§ðŸ‡¯", "Bhutan": "ðŸ‡§ðŸ‡¹",
            "Bolivia": "ðŸ‡§ðŸ‡´", "Bosnia and Herzegovina": "ðŸ‡§ðŸ‡¦", "Botswana": "ðŸ‡§ðŸ‡¼", "Brazil": "ðŸ‡§ðŸ‡·", "Brunei": "ðŸ‡§ðŸ‡³",
            "Bulgaria": "ðŸ‡§ðŸ‡¬", "Burkina Faso": "ðŸ‡§ðŸ‡«", "Burundi": "ðŸ‡§ðŸ‡®", "Cabo Verde": "ðŸ‡¨ðŸ‡»", "Cambodia": "ðŸ‡°ðŸ‡­",
            "Cameroon": "ðŸ‡¨ðŸ‡²", "Canada": "ðŸ‡¨ðŸ‡¦", "Central African Republic": "ðŸ‡¨ðŸ‡«", "Chad": "ðŸ‡¹ðŸ‡©", "Chile": "ðŸ‡¨ðŸ‡±",
            "China": "ðŸ‡¨ðŸ‡³", "Colombia": "ðŸ‡¨ðŸ‡´", "Comoros": "ðŸ‡°ðŸ‡²", "Congo": "ðŸ‡¨ðŸ‡¬", "Costa Rica": "ðŸ‡¨ðŸ‡·",
            "Croatia": "ðŸ‡­ðŸ‡·", "Cuba": "ðŸ‡¨ðŸ‡º", "Cyprus": "ðŸ‡¨ðŸ‡¾", "Czech Republic": "ðŸ‡¨ðŸ‡¿", "Denmark": "ðŸ‡©ðŸ‡°",
            "Djibouti": "ðŸ‡©ðŸ‡¯", "Dominica": "ðŸ‡©ðŸ‡²", "Dominican Republic": "ðŸ‡©ðŸ‡´", "Ecuador": "ðŸ‡ªðŸ‡¨", "Egypt": "ðŸ‡ªðŸ‡¬",
            "El Salvador": "ðŸ‡¸ðŸ‡»", "Equatorial Guinea": "ðŸ‡¬ðŸ‡¶", "Eritrea": "ðŸ‡ªðŸ‡·", "Estonia": "ðŸ‡ªðŸ‡ª", "Eswatini": "ðŸ‡¸ðŸ‡¿",
            "Ethiopia": "ðŸ‡ªðŸ‡¹", "Fiji": "ðŸ‡«ðŸ‡¯", "Finland": "ðŸ‡«ðŸ‡®", "France": "ðŸ‡«ðŸ‡·", "Gabon": "ðŸ‡¬ðŸ‡¦",
            "Gambia": "ðŸ‡¬ðŸ‡²", "Georgia": "ðŸ‡¬ðŸ‡ª", "Germany": "ðŸ‡©ðŸ‡ª", "Ghana": "ðŸ‡¬ðŸ‡­", "Greece": "ðŸ‡¬ðŸ‡·",
            "Grenada": "ðŸ‡¬ðŸ‡©", "Guatemala": "ðŸ‡¬ðŸ‡¹", "Guinea": "ðŸ‡¬ðŸ‡³", "Guinea-Bissau": "ðŸ‡¬ðŸ‡¼", "Guyana": "ðŸ‡¬ðŸ‡¾",
            "Haiti": "ðŸ‡­ðŸ‡¹", "Honduras": "ðŸ‡­ðŸ‡³", "Hungary": "ðŸ‡­ðŸ‡º", "Iceland": "ðŸ‡®ðŸ‡¸", "India": "ðŸ‡®ðŸ‡³",
            "Indonesia": "ðŸ‡®ðŸ‡©", "Iran": "ðŸ‡®ðŸ‡·", "Iraq": "ðŸ‡®ðŸ‡¶", "Ireland": "ðŸ‡®ðŸ‡ª", "Israel": "ðŸ‡®ðŸ‡±",
            "Italy": "ðŸ‡®ðŸ‡¹", "Jamaica": "ðŸ‡¯ðŸ‡²", "Japan": "ðŸ‡¯ðŸ‡µ", "Jordan": "ðŸ‡¯ðŸ‡´", "Kazakhstan": "ðŸ‡°ðŸ‡¿",
            "Kenya": "ðŸ‡°ðŸ‡ª", "Kiribati": "ðŸ‡°ðŸ‡®", "Kuwait": "ðŸ‡°ðŸ‡¼", "Kyrgyzstan": "ðŸ‡°ðŸ‡¬", "Laos": "ðŸ‡±ðŸ‡¦",
            "Latvia": "ðŸ‡±ðŸ‡»", "Lebanon": "ðŸ‡±ðŸ‡§", "Lesotho": "ðŸ‡±ðŸ‡¸", "Liberia": "ðŸ‡±ðŸ‡·", "Libya": "ðŸ‡±ðŸ‡¾",
            "Liechtenstein": "ðŸ‡±ðŸ‡®", "Lithuania": "ðŸ‡±ðŸ‡¹", "Luxembourg": "ðŸ‡±ðŸ‡º", "Madagascar": "ðŸ‡²ðŸ‡¬", "Malawi": "ðŸ‡²ðŸ‡¼",
            "Malaysia": "ðŸ‡²ðŸ‡¾", "Maldives": "ðŸ‡²ðŸ‡»", "Mali": "ðŸ‡²ðŸ‡±", "Malta": "ðŸ‡²ðŸ‡¹", "Marshall Islands": "ðŸ‡²ðŸ‡­",
            "Mauritania": "ðŸ‡²ðŸ‡·", "Mauritius": "ðŸ‡²ðŸ‡º", "Mexico": "ðŸ‡²ðŸ‡½", "Micronesia": "ðŸ‡«ðŸ‡²", "Moldova": "ðŸ‡²ðŸ‡©",
            "Monaco": "ðŸ‡²ðŸ‡¨", "Mongolia": "ðŸ‡²ðŸ‡³", "Montenegro": "ðŸ‡²ðŸ‡ª", "Morocco": "ðŸ‡²ðŸ‡¦", "Mozambique": "ðŸ‡²ðŸ‡¿",
            "Myanmar": "ðŸ‡²ðŸ‡²", "Namibia": "ðŸ‡³ðŸ‡¦", "Nauru": "ðŸ‡³ðŸ‡·", "Nepal": "ðŸ‡³ðŸ‡µ", "Netherlands": "ðŸ‡³ðŸ‡±",
            "New Zealand": "ðŸ‡³ðŸ‡¿", "Nicaragua": "ðŸ‡³ðŸ‡®", "Niger": "ðŸ‡³ðŸ‡ª", "Nigeria": "ðŸ‡³ðŸ‡¬", "North Korea": "ðŸ‡°ðŸ‡µ",
            "North Macedonia": "ðŸ‡²ðŸ‡°", "Norway": "ðŸ‡³ðŸ‡´", "Oman": "ðŸ‡´ðŸ‡²", "Pakistan": "ðŸ‡µðŸ‡°", "Palau": "ðŸ‡µðŸ‡¼",
            "Palestine": "ðŸ‡µðŸ‡¸", "Panama": "ðŸ‡µðŸ‡¦", "Papua New Guinea": "ðŸ‡µðŸ‡¬", "Paraguay": "ðŸ‡µðŸ‡¾", "Peru": "ðŸ‡µðŸ‡ª",
            "Philippines": "ðŸ‡µðŸ‡­", "Poland": "ðŸ‡µðŸ‡±", "Portugal": "ðŸ‡µðŸ‡¹", "Qatar": "ðŸ‡¶ðŸ‡¦", "Romania": "ðŸ‡·ðŸ‡´",
            "Russia": "ðŸ‡·ðŸ‡º", "Rwanda": "ðŸ‡·ðŸ‡¼", "Saint Kitts and Nevis": "ðŸ‡°ðŸ‡³", "Saint Lucia": "ðŸ‡±ðŸ‡¨", "Saint Vincent and the Grenadines": "ðŸ‡»ðŸ‡¨",
            "Samoa": "ðŸ‡¼ðŸ‡¸", "San Marino": "ðŸ‡¸ðŸ‡²", "Sao Tome and Principe": "ðŸ‡¸ðŸ‡¹", "Saudi Arabia": "ðŸ‡¸ðŸ‡¦", "Senegal": "ðŸ‡¸ðŸ‡³",
            "Serbia": "ðŸ‡·ðŸ‡¸", "Seychelles": "ðŸ‡¸ðŸ‡¨", "Sierra Leone": "ðŸ‡¸ðŸ‡±", "Singapore": "ðŸ‡¸ðŸ‡¬", "Slovakia": "ðŸ‡¸ðŸ‡°",
            "Slovenia": "ðŸ‡¸ðŸ‡®", "Solomon Islands": "ðŸ‡¸ðŸ‡§", "Somalia": "ðŸ‡¸ðŸ‡´", "South Africa": "ðŸ‡¿ðŸ‡¦", "South Korea": "ðŸ‡°ðŸ‡·",
            "South Sudan": "ðŸ‡¸ðŸ‡¸", "Spain": "ðŸ‡ªðŸ‡¸", "Sri Lanka": "ðŸ‡±ðŸ‡°", "Sudan": "ðŸ‡¸ðŸ‡©", "Suriname": "ðŸ‡¸ðŸ‡·",
            "Sweden": "ðŸ‡¸ðŸ‡ª", "Switzerland": "ðŸ‡¨ðŸ‡­", "Syria": "ðŸ‡¸ðŸ‡¾", "Taiwan": "ðŸ‡¹ðŸ‡¼", "Tajikistan": "ðŸ‡¹ðŸ‡¯",
            "Tanzania": "ðŸ‡¹ðŸ‡¿", "Thailand": "ðŸ‡¹ðŸ‡­", "Togo": "ðŸ‡¹ðŸ‡¬", "Tonga": "ðŸ‡¹ðŸ‡´", "Trinidad and Tobago": "ðŸ‡¹ðŸ‡¹",
            "Tunisia": "ðŸ‡¹ðŸ‡³", "Turkey": "ðŸ‡¹ðŸ‡·", "Turkmenistan": "ðŸ‡¹ðŸ‡²", "Tuvalu": "ðŸ‡¹ðŸ‡»", "Uganda": "ðŸ‡ºðŸ‡¬",
            "Ukraine": "ðŸ‡ºðŸ‡¦", "United Arab Emirates": "ðŸ‡¦ðŸ‡ª", "United Kingdom": "ðŸ‡¬ðŸ‡§", "United States": "ðŸ‡ºðŸ‡¸", "Uruguay": "ðŸ‡ºðŸ‡¾",
            "Uzbekistan": "ðŸ‡ºðŸ‡¿", "Vanuatu": "ðŸ‡»ðŸ‡º", "Vatican City": "ðŸ‡»ðŸ‡¦", "Venezuela": "ðŸ‡»ðŸ‡ª", "Vietnam": "ðŸ‡»ðŸ‡³",
            "Yemen": "ðŸ‡¾ðŸ‡ª", "Zambia": "ðŸ‡¿ðŸ‡²", "Zimbabwe": "ðŸ‡¿ðŸ‡¼"
        };

        const selectedLocations = [];

        const updateSelectedLocationsUI = () => {
            const selectedLocationsElement = document.getElementById('selected-locations');
            selectedLocationsElement.innerHTML = selectedLocations.map(country => `${countries[country]} ${country}`).join(', ');
        };

        const updateAvailableLocationsUI = (locations) => {
            const availableLocationsElement = document.getElementById('available-locations');
            availableLocationsElement.innerHTML = `You are available in: ${locations.map(country => `${countries[country]} ${country}`).join(', ')}`;
        };

        // Function to load user locations
        const loadUserLocations = async () => {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userDocRef = doc(db, "users", user.uid);
                    const userDoc = await getDoc(userDocRef);
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const userLocations = userData.location || [];
                        updateAvailableLocationsUI(userLocations);
                    }
                }
            });
        };

        // Load the locations when the page is loaded
        loadUserLocations();

        // Function to dynamically generate location checkboxes
        const generateLocationCheckboxes = () => {
            const locationCheckboxesElement = document.querySelector('.location-checkboxes');
            locationCheckboxesElement.innerHTML = '';
            Object.keys(countries).forEach(country => {
                const label = document.createElement('label');
                label.classList.add('location-checkbox');
                label.innerHTML = `
                    <input type="checkbox" value="${country}"> ${countries[country]} ${country}
                `;
                label.addEventListener('click', (e) => {
                    const checkbox = label.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    if (checkbox.checked && !selectedLocations.includes(country)) {
                        selectedLocations.push(country);
                    } else if (!checkbox.checked && selectedLocations.includes(country)) {
                        const index = selectedLocations.indexOf(country);
                        if (index > -1) {
                            selectedLocations.splice(index, 1);
                        }
                    }
                    updateSelectedLocationsUI();
                });
                locationCheckboxesElement.appendChild(label);
            });
        };

        // Generate checkboxes on page load
        generateLocationCheckboxes();

        // Function to handle track location button click
        document.getElementById('track-location').addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const { latitude, longitude } = position.coords;
                    const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`);
                    const data = await response.json();
                    const country = data.countryName;
                    if (country && !selectedLocations.includes(country) && countries[country]) {
                        selectedLocations.push(country);
                        updateSelectedLocationsUI();
                    } else if (!countries[country]) {
                        alert('Unable to determine your location.');
                    }
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });

        // Function to handle confirm button click
        document.getElementById('confirm-button').addEventListener('click', async () => {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userDocRef = doc(db, "users", user.uid);
                    await updateDoc(userDocRef, {
                        location: selectedLocations
                    });
                    alert('Locations saved successfully!');
                    loadUserLocations(); // Refresh the UI
                }
            });
        });
    </script>
</body>
</html>
